(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{91183:function(e,t,s){Promise.resolve().then(s.bind(s,68791))},68791:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(57437),i=s(2265),r=s(32660),n=s(39763);let l=(0,n.Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);var c=s(47692),d=s(95805);let o=(0,n.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),u=(0,n.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var x=s(27648),m=s(18112),h=s(64872),g=s(93303);function y(){let{instance:e,accounts:t}=(0,m.Fp)(),s=t[0],n=(null==s?void 0:s.username)||"",[y,p]=(0,i.useState)([]),[b,f]=(0,i.useState)(!0),[j,N]=(0,i.useState)(null),[v,k]=(0,i.useState)(null),[w,_]=(0,i.useState)(!1),[M,Z]=(0,i.useState)(""),[C,I]=(0,i.useState)(""),[S,F]=(0,i.useState)(!1),E=async()=>{f(!0),N(null);try{let e=await (0,g.i)("manage_users",{action:"list",admin_email:n});e.success?p(e.users):N(e.error||"Failed to load users")}catch(e){N(e instanceof Error?e.message:"Failed to load users")}finally{f(!1)}},O=async(e,t,s)=>{k(e+t);try{let a=await (0,g.i)("manage_users",{action:"update",admin_email:n,user_data:{id:e,[t]:!s}});a.success?p(y.map(a=>a.id===e?{...a,[t]:!s}:a)):N(a.error||"Failed to update permission")}catch(e){N(e instanceof Error?e.message:"Failed to update")}finally{k(null)}},T=async()=>{if(!M||!C){N("Email and display name are required");return}F(!0),N(null);try{let e=await (0,g.i)("manage_users",{action:"create",admin_email:n,user_data:{email:M,display_name:C}});e.success?(p([...y,e.user]),Z(""),I(""),_(!1)):N(e.error||"Failed to add user")}catch(e){N(e instanceof Error?e.message:"Failed to add user")}finally{F(!1)}},U=async(e,t)=>{if(confirm("Delete user ".concat(t,"? This cannot be undone."))){k(e);try{let t=await (0,g.i)("manage_users",{action:"delete",admin_email:n,user_data:{id:e}});t.success?p(y.filter(t=>t.id!==e)):N(t.error||"Failed to delete user")}catch(e){N(e instanceof Error?e.message:"Failed to delete user")}finally{k(null)}}};(0,i.useEffect)(()=>{n&&E()},[n]);let A=e=>e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"Never",J=[{key:"can_view",label:"View"},{key:"can_edit_time",label:"Edit Time"},{key:"can_send_reminders",label:"Send Reminders"},{key:"can_create_invoices",label:"Create Invoices"},{key:"can_manage_users",label:"Manage Users"},{key:"is_admin",label:"Admin"}];return(0,a.jsx)(h.Z,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(x.default,{href:"/",className:"text-gray-600 hover:text-gray-900",children:(0,a.jsx)(r.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l,{className:"w-6 h-6 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Manage app users and permissions"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right hidden md:block",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==s?void 0:s.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null==s?void 0:s.username})]}),(0,a.jsx)("button",{onClick:()=>{e.logoutPopup()},className:"px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Sign Out",children:(0,a.jsx)(c.Z,{className:"w-5 h-5"})})]})]})})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[j&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-lg border ".concat(j.startsWith("âœ…")?"bg-green-50 border-green-300 text-green-800":"bg-red-50 border-red-300 text-red-800"),children:j}),(0,a.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5 inline mr-2"}),y.length," Users"]}),(0,a.jsxs)("button",{onClick:()=>_(!w),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,a.jsx)(o,{className:"w-4 h-4"}),"Add User"]})]}),w&&(0,a.jsxs)("div",{className:"mb-6 bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New User"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:M,onChange:e=>Z(e.target.value),placeholder:"user@mitigationconsulting.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),(0,a.jsx)("input",{type:"text",value:C,onChange:e=>I(e.target.value),placeholder:"John Doe",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:T,disabled:S,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:S?"Adding...":"Add User"}),(0,a.jsx)("button",{onClick:()=>{_(!1),Z(""),I("")},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]}),b?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"User"}),J.map(e=>(0,a.jsx)("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-600 uppercase",children:e.label},e.key)),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Last Login"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:y.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.display_name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]})}),J.map(t=>(0,a.jsx)("td",{className:"px-3 py-3 text-center",children:(0,a.jsx)("button",{onClick:()=>O(e.id,t.key,e[t.key]),disabled:v===e.id+t.key,className:"w-10 h-6 rounded-full relative transition-colors ".concat(e[t.key]?"bg-indigo-600":"bg-gray-300"," ").concat(v===e.id+t.key?"opacity-50":""),children:(0,a.jsx)("span",{className:"absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform ".concat(e[t.key]?"translate-x-4":"translate-x-0.5")})})},t.key)),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:A(e.last_login)}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("button",{onClick:()=>U(e.id,e.email),disabled:e.email===n||v===e.id,className:"text-red-500 hover:text-red-700 disabled:opacity-30 disabled:cursor-not-allowed p-1",title:e.email===n?"Cannot delete yourself":"Delete user",children:(0,a.jsx)(u,{className:"w-4 h-4"})})})]},e.id))})]})})})]})]})})}},64872:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var a=s(57437),i=s(18112),r=s(34847),n=s(91723),l=s(29090);function c(e){let{children:t}=e,{instance:s,accounts:c}=(0,i.Fp)(),d=c.length>0,o=async()=>{try{await s.loginPopup(r.Qb)}catch(e){console.error("Login failed:",e)}};return d?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"w-10 h-10 text-white"})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"MIT Consulting"}),(0,a.jsx)("p",{className:"text-gray-600",children:"QuickBooks Timesheet System"})]}),(0,a.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Authentication Required:"})," Please sign in with your Microsoft account to access this page."]})}),(0,a.jsxs)("button",{onClick:o,className:"w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center gap-2",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5"}),"Sign in with Microsoft"]})]})})}},34847:function(e,t,s){"use strict";s.d(t,{Qb:function(){return i},XM:function(){return a}});let a={auth:{clientId:"973b689d-d96c-4445-883b-739fff12330b",authority:"https://login.microsoftonline.com/".concat("aee0257d-3be3-45ae-806b-65c972c98dfb"),redirectUri:"http://localhost:3000"},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}},i={scopes:["User.Read","email","profile","openid","Mail.Send","Mail.ReadWrite"]}},93303:function(e,t,s){"use strict";s.d(t,{O:function(){return n},i:function(){return l}});var a=s(13053);let i="https://migcpasmtbdojqphqyzc.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ",n=(0,a.eI)(i,r);async function l(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",a="".concat(i,"/functions/v1/").concat(e),n=await fetch(a,{method:s,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:t?JSON.stringify(t):void 0});if(!n.ok){let e=await n.text();throw Error("Edge Function error: ".concat(e))}return n.json()}},32660:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},91723:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(39763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},29090:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(39763).Z)("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]])},47692:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(39763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},95805:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(39763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])}},function(e){e.O(0,[641,112,971,117,744],function(){return e(e.s=91183)}),_N_E=e.O()}]);