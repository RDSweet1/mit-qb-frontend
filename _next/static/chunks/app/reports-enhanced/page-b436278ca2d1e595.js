(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{49518:function(e,t,s){Promise.resolve().then(s.bind(s,39706))},39706:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var r=s(57437),a=s(2265),n=s(32660),l=s(44743),i=s(42208);let c=(0,s(39763).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var d=s(48736),o=s(98420),m=s(91723),u=s(92369),x=s(30401),h=s(32489),p=s(27648),g=s(93303),y=s(70967),b=s(2085),f=s(65696),j=s(86035);function N(){let[e,t]=(0,a.useState)(!1),[s,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)([]),[k,S]=(0,a.useState)([]),[_,Z]=(0,a.useState)(new Set),[M,C]=(0,a.useState)(!1),[I,O]=(0,a.useState)(null),[F,T]=(0,a.useState)(()=>{let e=(0,y.t)(new Date,1);return(0,b.WU)((0,f.z)(e,{weekStartsOn:1}),"yyyy-MM-dd")}),[z,E]=(0,a.useState)(()=>{let e=(0,y.t)(new Date,1);return(0,b.WU)((0,j.v)(e,{weekStartsOn:1}),"yyyy-MM-dd")}),[J,D]=(0,a.useState)(""),[X,R]=(0,a.useState)(""),q=async()=>{try{t(!0);let{data:e,error:s}=await g.O.from("time_entries").select("*").gte("entry_date",F).lte("entry_date",z).eq("billable_status","Billable").order("customer_name").order("entry_date");if(s)throw s;let r=e||[];w(r);let a=r.reduce((e,t)=>(e[t.customer_name]||(e[t.customer_name]={customer_name:t.customer_name,total_hours:0,entries:[],email:""}),e[t.customer_name].total_hours+=t.hours,e[t.customer_name].entries.push(t),e),{}),n=Object.values(a);S(n),Z(new Set(n.map(e=>e.customer_name)))}catch(e){console.error("Error loading time entries:",e)}finally{t(!1)}};(0,a.useEffect)(()=>{q()},[F,z]);let H=e=>{let t=new Set(_);t.has(e)?t.delete(e):t.add(e),Z(t)},L=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e&&!M){C(!0);return}try{N(!0);let e=k.filter(e=>_.has(e.customer_name));if(!(await fetch("".concat("https://migcpasmtbdojqphqyzc.supabase.co","/functions/v1/send-reminder"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ")},body:JSON.stringify({weekStart:F,weekEnd:z,customers:e.map(e=>e.customer_name)})})).ok)throw Error("Failed to send reports");alert("✅ Successfully sent ".concat(e.length," reports!")),C(!1)}catch(e){console.error("Error sending reports:",e),alert("❌ Error sending reports. Please try again.")}finally{N(!1)}},P=k.filter(e=>(!J||!!e.customer_name.toLowerCase().includes(J.toLowerCase()))&&(!X||!!e.entries.some(e=>e.employee_name.toLowerCase().includes(X.toLowerCase())))),Y=_.size,G=k.filter(e=>_.has(e.customer_name)).reduce((e,t)=>e+t.total_hours,0);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(p.default,{href:"/",className:"text-gray-600 hover:text-gray-900",children:(0,r.jsx)(n.Z,{className:"w-6 h-6"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Weekly Time Reports"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Search, filter, preview, and send reports to customers"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[!M&&(0,r.jsxs)("button",{onClick:()=>L(!0),disabled:s||0===Y,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),"Send Without Review"]}),(0,r.jsx)("button",{onClick:()=>L(!1),disabled:s||0===Y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),s?"Sending...":"Send ".concat(Y," Reports")]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{className:"w-4 h-4"}),"Review & Send"]})})]})]})})}),(0,r.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:M?(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-8",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Review Reports Before Sending"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["You are about to send ",Y," report",1!==Y?"s":""," to the following customers:"]})]}),(0,r.jsx)("div",{className:"space-y-3 mb-8",children:k.filter(e=>_.has(e.customer_name)).map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(x.Z,{className:"w-5 h-5 text-green-600"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:e.customer_name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.total_hours.toFixed(2)," hours"]})]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[e.entries.length," entries"]})]},e.customer_name))}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("button",{onClick:()=>L(!1),disabled:s,className:"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"spinner w-5 h-5 border-2"}),"Sending..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{className:"w-5 h-5"}),"Confirm & Send ",Y," Reports"]})}),(0,r.jsx)("button",{onClick:()=>C(!1),disabled:s,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:(0,r.jsx)(h.Z,{className:"w-5 h-5"})})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,r.jsx)(c,{className:"w-5 h-5"}),"Search & Filter"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,r.jsx)("input",{type:"date",value:F,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,r.jsx)("input",{type:"date",value:z,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Customer"}),(0,r.jsx)("input",{type:"text",placeholder:"Search customer...",value:J,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Employee"}),(0,r.jsx)("input",{type:"text",placeholder:"Search employee...",value:X,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,r.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Period: ",(0,b.WU)(new Date(F),"MMM dd, yyyy")," - ",(0,b.WU)(new Date(z),"MMM dd, yyyy")]}),(0,r.jsx)("button",{onClick:q,disabled:e,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:e?"Loading...":"Refresh"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Customers"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:P.length})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Selected to Send"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:Y})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Hours (Selected)"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-600",children:G.toFixed(2)})]})]}),(0,r.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,r.jsxs)("button",{onClick:()=>{Z(new Set(k.map(e=>e.customer_name)))},className:"px-4 py-2 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors",children:["Select All (",P.length,")"]}),(0,r.jsx)("button",{onClick:()=>{Z(new Set)},className:"px-4 py-2 text-sm bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Deselect All"})]}),(0,r.jsx)("div",{className:"space-y-4",children:e?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"spinner"})}):0===P.length?(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[(0,r.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Time Entries Found"}),(0,r.jsx)("p",{className:"text-gray-600",children:"No billable hours found for the selected date range. Try adjusting your search criteria."})]}):P.map(e=>(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border-2 transition-all ".concat(_.has(e.customer_name)?"border-blue-500 bg-blue-50":"border-gray-200"),children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("input",{type:"checkbox",checked:_.has(e.customer_name),onChange:()=>H(e.customer_name),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(o.Z,{className:"w-5 h-5 text-gray-400"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.customer_name})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4"}),e.total_hours.toFixed(2)," hours"]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4"}),new Set(e.entries.map(e=>e.employee_name)).size," employees"]})]})]})]}),(0,r.jsxs)("button",{onClick:()=>O(I===e.customer_name?null:e.customer_name),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:[I===e.customer_name?"Hide":"Show"," Details"]})]}),I===e.customer_name&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Service"}),(0,r.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Hours"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[e.entries.map((e,t)=>(0,r.jsxs)("tr",{className:"text-sm",children:[(0,r.jsx)("td",{className:"px-4 py-2 text-gray-900",children:(0,b.WU)(new Date(e.entry_date),"MMM dd")}),(0,r.jsx)("td",{className:"px-4 py-2 text-gray-900",children:e.employee_name}),(0,r.jsx)("td",{className:"px-4 py-2 text-gray-600",children:e.service_item}),(0,r.jsx)("td",{className:"px-4 py-2 text-right font-medium text-gray-900",children:e.hours.toFixed(2)})]},t)),(0,r.jsxs)("tr",{className:"bg-gray-50 font-semibold",children:[(0,r.jsx)("td",{colSpan:3,className:"px-4 py-2 text-right text-gray-900",children:"Total:"}),(0,r.jsxs)("td",{className:"px-4 py-2 text-right text-gray-900",children:[e.total_hours.toFixed(2)," hrs"]})]})]})]})})]})},e.customer_name))})]})})]})}},93303:function(e,t,s){"use strict";s.d(t,{O:function(){return l},i:function(){return i}});var r=s(13053);let a="https://migcpasmtbdojqphqyzc.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ",l=(0,r.eI)(a,n);async function i(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",r="".concat(a,"/functions/v1/").concat(e),l=await fetch(r,{method:s,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:t?JSON.stringify(t):void 0});if(!l.ok){let e=await l.text();throw Error("Edge Function error: ".concat(e))}return l.json()}},32660:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},98420:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},30401:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},91723:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},42208:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},48736:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},44743:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},92369:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},32489:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},59121:function(e,t,s){"use strict";s.d(t,{E:function(){return n}});var r=s(99649),a=s(63497);function n(e,t){let s=(0,r.Q)(e);return isNaN(t)?(0,a.L)(e,NaN):(t&&s.setDate(s.getDate()+t),s)}},86035:function(e,t,s){"use strict";s.d(t,{v:function(){return n}});var r=s(99649),a=s(55528);function n(e,t){var s,n,l,i,c,d,o,m;let u=(0,a.j)(),x=null!==(m=null!==(o=null!==(d=null!==(c=null==t?void 0:t.weekStartsOn)&&void 0!==c?c:null==t?void 0:null===(n=t.locale)||void 0===n?void 0:null===(s=n.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==d?d:u.weekStartsOn)&&void 0!==o?o:null===(i=u.locale)||void 0===i?void 0:null===(l=i.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==m?m:0,h=(0,r.Q)(e),p=h.getDay();return h.setDate(h.getDate()+((p<x?-7:0)+6-(p-x))),h.setHours(23,59,59,999),h}},70967:function(e,t,s){"use strict";s.d(t,{t:function(){return a}});var r=s(59121);function a(e,t){var s;return s=-t,(0,r.E)(e,7*s)}}},function(e){e.O(0,[641,85,971,117,744],function(){return e(e.s=49518)}),_N_E=e.O()}]);