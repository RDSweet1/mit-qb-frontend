(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{28840:function(e,t,s){Promise.resolve().then(s.bind(s,86714))},86714:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return X}});var a=s(57437),r=s(2265),l=s(32660),n=s(82431),i=s(47692),o=s(20265),c=s(15051),d=s(91723),m=s(65302),x=s(32489),u=s(48736),p=s(89345),h=s(98420),g=s(31047),b=s(92369),y=s(65621),j=s(82023),f=s(27648),v=s(2085),N=s(63070),w=s(945),_=s(27742),k=s(65696),S=s(86035),C=s(13053),I=s(18112),D=s(64872),E=s(66337),Z=s(39711);function O(e){let{isLocked:t,unlockedBy:s,unlockedAt:l,onToggle:n,disabled:i=!1}=e,[o,c]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("button",{onClick:n,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),disabled:i,className:"\n          p-1.5 rounded-md transition-all\n          ".concat(t?"text-gray-500 hover:text-red-600 hover:bg-red-50":"text-orange-500 hover:text-green-600 hover:bg-green-50","\n          ").concat(i?"opacity-50 cursor-not-allowed":"cursor-pointer","\n        "),"aria-label":t?"Unlock entry":"Lock entry",children:t?(0,a.jsx)(E.Z,{className:"w-5 h-5"}):(0,a.jsx)(Z.Z,{className:"w-5 h-5"})}),o&&(0,a.jsxs)("div",{className:"absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg whitespace-nowrap",children:[t?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:"\uD83D\uDD12 Locked"}),(0,a.jsx)("div",{className:"text-gray-300",children:"Click to unlock and edit"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:"\uD83D\uDD13 Unlocked"}),s&&(0,a.jsxs)("div",{className:"text-gray-300",children:["by ",s.split("@")[0]]}),l&&(0,a.jsx)("div",{className:"text-gray-400 text-[10px]",children:new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}),(0,a.jsx)("div",{className:"text-orange-300 mt-1",children:"Click to lock again"})]}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-px",children:(0,a.jsx)("div",{className:"border-4 border-transparent border-t-gray-900"})})]})]})}var M=s(63639);function T(e){var t,s;let{isOpen:r,isLocking:l,entryDetails:n,onConfirm:i,onCancel:o}=e;return r?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:o}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-2xl max-w-md w-full mx-4",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b ".concat(l?"bg-green-50":"bg-orange-50"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[l?(0,a.jsx)(E.Z,{className:"w-6 h-6 text-green-600"}):(0,a.jsx)(M.Z,{className:"w-6 h-6 text-orange-600"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:l?"Lock Time Entry?":"Unlock Time Entry?"})]})}),(0,a.jsxs)("div",{className:"px-6 py-5",children:[n&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-gray-50 rounded-md border border-gray-200",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:n.employee_name}),(0,a.jsx)("div",{children:new Date(n.txn_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),(0,a.jsx)("div",{children:(t=n.hours,s=n.minutes,"".concat((t+s/60).toFixed(2)," hours"))})]})}),l?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-gray-700",children:"This will lock the time entry and prevent editing."}),(0,a.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md",children:(0,a.jsxs)("p",{className:"text-sm text-green-800",children:[(0,a.jsx)("strong",{children:"Protection:"})," Entry will be read-only and protected from accidental changes."]})})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-gray-700",children:"This will allow you to edit this time entry."}),(0,a.jsx)("div",{className:"p-4 bg-orange-50 border-l-4 border-orange-500 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(M.Z,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"text-sm text-orange-900",children:[(0,a.jsx)("p",{className:"font-bold mb-2",children:"WARNING:"}),(0,a.jsxs)("ul",{className:"space-y-1 list-disc list-inside",children:[(0,a.jsxs)("li",{children:["Changes will ",(0,a.jsx)("strong",{children:"NOT"})," sync back to QuickBooks"]}),(0,a.jsx)("li",{children:"This creates a local-only modification"}),(0,a.jsx)("li",{children:"Next QB sync may overwrite your changes"}),(0,a.jsx)("li",{children:"Use only when necessary"})]})]})]})}),(0,a.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Best Practice:"})," Make changes in QuickBooks whenever possible."]})})]})]}),(0,a.jsxs)("div",{className:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:o,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:i,className:"\n              px-4 py-2 text-white rounded-md transition-colors font-medium\n              ".concat(l?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700","\n            "),children:l?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4"}),"Yes, Lock It"]}):(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4"}),"Yes, Unlock It"]})})]})]})]}):null}var J=s(99801),A=s(42208),F=s(45131),B=s(93303);function U(e){let{isOpen:t,entryId:s,entryDetails:l,onClose:n}=e,[i,o]=(0,r.useState)([]),[c,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&s&&h()},[t,s]);let h=async()=>{if(s){u(!0);try{let{data:e,error:t}=await B.O.from("approval_audit_log").select("*").eq("time_entry_id",s).order("performed_at",{ascending:!1});if(t)throw t;o(e||[])}catch(e){console.error("Failed to load history:",e)}finally{u(!1)}}};if(!t)return null;let g=e=>{switch(e){case"approved":return(0,a.jsx)(m.Z,{className:"w-5 h-5 text-emerald-600"});case"sent":return(0,a.jsx)(p.Z,{className:"w-5 h-5 text-blue-600"});case"delivered":return(0,a.jsx)(J.Z,{className:"w-5 h-5 text-indigo-600"});case"read":return(0,a.jsx)(A.Z,{className:"w-5 h-5 text-purple-600"});case"declined_read":return(0,a.jsx)(F.Z,{className:"w-5 h-5 text-orange-600"});default:return(0,a.jsx)(d.Z,{className:"w-5 h-5 text-gray-600"})}},y=e=>{switch(e){case"approved":return"Approved";case"sent":return"Sent to Customer";case"delivered":return"Delivered";case"read":return"Read by Customer";case"declined_read":return"Read Receipt Declined";case"unlock":return"Unlocked";case"lock":return"Locked";case"edit":return"Edited";default:return e}},j=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n}),(0,a.jsxs)("div",{className:"relative bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Tracking History"}),l&&(0,a.jsxs)("p",{className:"text-blue-100 text-sm mt-1",children:[l.employee_name," • ",l.txn_date," • ",l.hours,"h ",l.minutes,"m"]})]}),(0,a.jsx)("button",{onClick:n,className:"text-white hover:bg-blue-800 rounded-lg p-2 transition-colors",children:(0,a.jsx)(x.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-100px)]",children:c?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===i.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(d.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No tracking history available"})]}):(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"relative",children:i.map((e,t)=>(0,a.jsxs)("div",{className:"relative pb-8 last:pb-0",children:[t!==i.length-1&&(0,a.jsx)("div",{className:"absolute left-[18px] top-8 bottom-0 w-0.5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-9 h-9 rounded-full bg-white border-2 border-gray-200 flex items-center justify-center",children:g(e.action)}),(0,a.jsxs)("div",{className:"flex-1 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:y(e.action)}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3 inline mr-1"}),e.performed_by]})]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:j(e.performed_at)})]}),e.details&&Object.keys(e.details).length>0&&(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,a.jsxs)("details",{className:"text-xs",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-gray-600 hover:text-gray-900 font-medium",children:"View Details"}),(0,a.jsx)("div",{className:"mt-2 space-y-1 text-gray-600 bg-white p-2 rounded",children:Object.entries(e.details).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("span",{className:"font-medium",children:[t,":"]}),(0,a.jsx)("span",{className:"break-all",children:"object"==typeof s?JSON.stringify(s):String(s)})]},t)})})]})})]})]})]},e.id))})})}),(0,a.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end",children:(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})})]})]})})}var z=s(30401),R=s(45675);function q(e){let{entryId:t,currentNotes:s,isLocked:l,isSaving:n,onSave:i}=e,[o,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(s||""),u=async()=>{await i(t,d),c(!1)};return o?(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("textarea",{value:d,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 text-sm border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-y",rows:3,autoFocus:!0,disabled:n}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsxs)("button",{onClick:u,disabled:n,className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 disabled:opacity-50",children:[(0,a.jsx)(z.Z,{className:"w-3 h-3"}),n?"Saving...":"Save"]}),(0,a.jsxs)("button",{onClick:()=>{m(s||""),c(!1)},disabled:n,className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3"}),"Cancel"]})]})]}):(0,a.jsxs)("div",{className:"flex items-start gap-1 group",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600 italic",children:[(0,a.jsx)("span",{className:"font-medium",children:"Notes:"})," ",s||"No notes"]}),!l&&(0,a.jsx)("button",{onClick:()=>{m(s||""),c(!0)},className:"flex-shrink-0 p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit notes",children:(0,a.jsx)(R.Z,{className:"w-3.5 h-3.5"})})]})}function P(e){let{isOpen:t,entry:s,onAccept:l,onClose:n}=e,[i,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&s&&g()},[t,null==s?void 0:s.id]);let g=async()=>{if(s){d(!0),h(null),o("");try{let e=await (0,B.i)("enhance_notes",{notes:s.notes,description:s.description,employee_name:s.employee_name,customer:s.qb_customer_id,cost_code:s.cost_code,service_item_name:s.service_item_name,hours:s.hours,minutes:s.minutes,date:s.txn_date});e.success?o(e.enhanced_notes):h(e.error||"Enhancement failed")}catch(e){h(e instanceof Error?e.message:"Failed to enhance notes")}finally{d(!1)}}},b=async()=>{if(s&&i){u(!0);try{await l(s.id,i),n()}catch(e){h(e instanceof Error?e.message:"Failed to save")}finally{u(!1)}}};return t&&s?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n}),(0,a.jsxs)("div",{className:"relative bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 px-6 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-white"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"AI Note Enhancement"}),(0,a.jsxs)("p",{className:"text-purple-100 text-sm mt-1",children:[s.employee_name," - ",s.txn_date," - ",s.hours,"h ",s.minutes,"m"]})]})]}),(0,a.jsx)("button",{onClick:n,className:"text-white hover:bg-purple-800 rounded-lg p-2 transition-colors",children:(0,a.jsx)(x.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-180px)]",children:[p&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:p}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Original Notes"}),(0,a.jsx)("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700 min-h-[120px]",children:s.notes||s.description||"No notes available"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["AI Suggestion",(0,a.jsx)("span",{className:"text-xs font-normal text-gray-500 ml-1",children:"(editable)"})]}),c?(0,a.jsx)("div",{className:"flex items-center justify-center p-8 bg-purple-50 border border-purple-200 rounded-lg min-h-[120px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-purple-600",children:"Generating enhanced notes..."})]})}):(0,a.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full p-3 border border-purple-200 rounded-lg text-sm text-gray-700 min-h-[120px] focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-y",placeholder:"AI-generated suggestion will appear here..."})]})]}),(0,a.jsx)("p",{className:"mt-4 text-xs text-gray-500 italic",children:"AI-generated content should be reviewed before saving. The suggestion is based on the original notes and entry context."})]}),(0,a.jsxs)("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("button",{onClick:g,disabled:c,className:"flex items-center gap-1 px-3 py-2 text-sm text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 transition-colors disabled:opacity-50",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"}),"Regenerate"]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,a.jsxs)("button",{onClick:b,disabled:c||m||!i,className:"flex items-center gap-2 px-4 py-2 text-sm text-white bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:[(0,a.jsx)(z.Z,{className:"w-4 h-4"}),m?"Saving...":"Accept & Save"]})]})]})]})]})}):null}let W=(0,C.eI)("https://migcpasmtbdojqphqyzc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ");function X(){var e;let{instance:t,accounts:s}=(0,I.Fp)(),C=s[0],[E,Z]=(0,r.useState)([]),[M,J]=(0,r.useState)([]),[A,F]=(0,r.useState)(!0),[B,z]=(0,r.useState)(!1),[R,X]=(0,r.useState)(null),[Q,L]=(0,r.useState)("last_month"),[Y,G]=(0,r.useState)((0,v.WU)((0,N.N)((0,w.W)(new Date,1)),"yyyy-MM-dd")),[V,H]=(0,r.useState)((0,v.WU)((0,_.V)((0,w.W)(new Date,1)),"yyyy-MM-dd")),[K,$]=(0,r.useState)("all"),[ee,et]=(0,r.useState)("all"),[es,ea]=(0,r.useState)("datetime"),[er,el]=(0,r.useState)("desc"),[en,ei]=(0,r.useState)(!1),[eo,ec]=(0,r.useState)(null),[ed,em]=(0,r.useState)(!1),[ex,eu]=(0,r.useState)(new Set),[ep,eh]=(0,r.useState)("all"),[eg,eb]=(0,r.useState)(!1),[ey,ej]=(0,r.useState)(!1),[ef,ev]=(0,r.useState)(null),[eN,ew]=(0,r.useState)(!1),[e_,ek]=(0,r.useState)(!1),[eS,eC]=(0,r.useState)(null),eI=async()=>{try{let{data:e,error:t}=await W.from("customers").select("qb_customer_id, display_name, email").eq("is_active",!0).order("display_name");if(t)throw t;J(e||[])}catch(e){console.error("Error loading customers:",e)}},eD=async()=>{try{F(!0),X(null);let e=W.from("time_entries").select("*").gte("txn_date",Y).lte("txn_date",V);"all"!==K&&(e=e.eq("qb_customer_id",K)),"all"!==ee&&(e=e.eq("employee_name",ee));let{data:t,error:s}=await e;if(s)throw s;Z(t||[])}catch(e){X(e instanceof Error?e.message:"Failed to load time entries")}finally{F(!1)}},eE=async(e,t)=>{try{X(null);let s={startDate:Y,endDate:V,entries:eP.map(e=>({date:e.txn_date,employee:e.employee_name,customer:e.qb_customer_id,costCode:e.cost_code,hours:"".concat(e.hours,".").concat(e.minutes.toString().padStart(2,"0")),billable:e.billable_status,description:e.description})),summary:{totalEntries:E.length,totalHours:eX(E)}},a=await fetch("".concat("https://migcpasmtbdojqphqyzc.supabase.co","/functions/v1/email_time_report"),{method:"POST",headers:{Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ"),"Content-Type":"application/json"},body:JSON.stringify({report:s,recipient:e})});if(!a.ok)throw Error("Email failed: ".concat(a.statusText));let r=await a.json();if(r.success)X("✅ Report emailed successfully to ".concat(t,"!"));else throw Error(r.error||"Email sending failed")}catch(e){console.error("❌ Email report failed:",e),X("Failed to email report: "+(e instanceof Error?e.message:"Unknown error"))}},eZ=async()=>{if("all"===K){X("⚠️ Please select a specific customer to email the report to them.");return}let e=M.find(e=>e.qb_customer_id===K);if(!e){X("❌ Customer not found");return}if(!e.email){X("❌ Customer email not found. Please add customer email in QuickBooks.");return}eE(e.email,"Customer (".concat(e.display_name,")"))},eO=e=>{let t=new Set(ex);t.has(e)?t.delete(e):t.add(e),eu(t)},eM=async()=>{if(0===ex.size){X("⚠️ No entries selected");return}try{eb(!0),X(null);let e=Array.from(ex),t=(null==C?void 0:C.username)||"unknown",{error:s}=await W.from("time_entries").update({approval_status:"approved",approved_by:t,approved_at:new Date().toISOString()}).in("id",e);if(s)throw s;let a=e.map(e=>({time_entry_id:e,action:"approved",performed_by:t,performed_at:new Date().toISOString(),details:{method:"bulk_approve"}}));await W.from("approval_audit_log").insert(a),await eJ(e),X("✅ Approved ".concat(e.length," entries and sent to customer!")),eu(new Set),await eD()}catch(e){console.error("Approval failed:",e),X("❌ Failed to approve entries: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{eb(!1)}},eT=async()=>{let e=eq().filter(e=>"pending"===e.approval_status);if(0===e.length){X("⚠️ No pending entries to approve");return}eu(new Set(e.map(e=>e.id))),await eM()},eJ=async e=>{try{let{data:t,error:s}=await W.from("time_entries").select("*").in("id",e);if(s)throw s;if(!t||0===t.length)return;let a=new Map;for(let[e,s]of(t.forEach(e=>{let t=e.qb_customer_id;a.has(t)||a.set(t,[]),a.get(t).push(e)}),a)){let t=M.find(t=>t.qb_customer_id===e);if(!(null==t?void 0:t.email)){console.warn("No email for customer ".concat(e,", skipping"));continue}let a={startDate:Y,endDate:V,entries:s.map(e=>({date:e.txn_date,employee:e.employee_name,customer:e.qb_customer_id,costCode:e.cost_code,hours:"".concat(e.hours,".").concat(e.minutes.toString().padStart(2,"0")),billable:e.billable_status,description:e.description})),summary:{totalEntries:s.length,totalHours:eX(s)}};(await fetch("".concat("https://migcpasmtbdojqphqyzc.supabase.co","/functions/v1/email_time_report"),{method:"POST",headers:{Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ"),"Content-Type":"application/json"},body:JSON.stringify({report:a,recipient:t.email,entryIds:s.map(e=>e.id),customerId:e,sentBy:(null==C?void 0:C.username)||"system"})})).ok&&(await W.from("time_entries").update({approval_status:"sent",sent_at:new Date().toISOString(),sent_to:t.email}).in("id",s.map(e=>e.id)),await W.from("approval_audit_log").insert(s.map(e=>({time_entry_id:e.id,action:"sent",performed_by:(null==C?void 0:C.username)||"system",performed_at:new Date().toISOString(),details:{recipient:t.email}}))))}}catch(e){throw console.error("Failed to send emails:",e),e}},eA=async(e,t)=>{let s=(null==C?void 0:C.username)||"unknown",a=E.find(t=>t.id===e),r=(null==a?void 0:a.edit_count)||0;ew(!0);try{let{error:a}=await W.from("time_entries").update({notes:t,updated_at:new Date().toISOString(),updated_by:s,manually_edited:!0,edit_count:r+1}).eq("id",e);if(a)throw a;Z(E.map(a=>a.id===e?{...a,notes:t,manually_edited:!0,edit_count:r+1,updated_at:new Date().toISOString(),updated_by:s}:a))}catch(e){throw X(e instanceof Error?e.message:"Failed to save notes"),e}finally{ew(!1)}},eF=async()=>{try{console.log("\uD83D\uDD04 QB Sync: Starting sync..."),console.log("\uD83D\uDCC5 Date Range:",{startDate:Y,endDate:V}),z(!0),X(null);let e="".concat("https://migcpasmtbdojqphqyzc.supabase.co","/functions/v1/qb-time-sync");console.log("\uD83C\uDF10 QB Sync: Calling Edge Function:",e);let t={startDate:Y,endDate:V,billableOnly:!1};console.log("\uD83D\uDCE6 Request Body:",t);let s=await fetch(e,{method:"POST",headers:{Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ"),"Content-Type":"application/json"},body:JSON.stringify(t)});console.log("\uD83D\uDCE1 QB Sync: Response Status:",s.status);let a=await s.json();if(console.log("\uD83D\uDCC4 QB Sync: Response Data:",a),!s.ok){let e=a.error||"Sync failed";console.error("❌ QB Sync: Error:",e),a.error&&a.error.includes("invalid_client")?X("QuickBooks authentication failed. Client credentials may be incorrect. Check Edge Function logs in Supabase."):a.error&&a.error.includes("Token refresh failed")?X("Token refresh failed: ".concat(a.error)):X("Sync failed: ".concat(e));return}console.log("✅ QB Sync: Success!",{synced:a.synced,total:a.total,customers:a.customers}),X("✅ Success! Synced ".concat(a.synced," time entries from ").concat(a.customers," customers.")),await eD()}catch(t){console.error("❌ QB Sync: Fatal error:",t);let e=t instanceof Error?t.message:"Failed to sync with QuickBooks";X("Fatal error: ".concat(e))}finally{z(!1)}},eB=e=>{L(e);let t=new Date;switch(e){case"this_week":G((0,v.WU)((0,k.z)(t,{weekStartsOn:1}),"yyyy-MM-dd")),H((0,v.WU)((0,S.v)(t,{weekStartsOn:1}),"yyyy-MM-dd"));break;case"last_week":let s=(0,w.W)(t,0),a=(0,k.z)(new Date(s.getTime()-6048e5),{weekStartsOn:1});G((0,v.WU)(a,"yyyy-MM-dd")),H((0,v.WU)((0,S.v)(a,{weekStartsOn:1}),"yyyy-MM-dd"));break;case"this_month":G((0,v.WU)((0,N.N)(t),"yyyy-MM-dd")),H((0,v.WU)((0,_.V)(t),"yyyy-MM-dd"));break;case"last_month":let r=(0,w.W)(t,1);G((0,v.WU)((0,N.N)(r),"yyyy-MM-dd")),H((0,v.WU)((0,_.V)(r),"yyyy-MM-dd"));break;case"all_time":G("2020-01-01"),H((0,v.WU)(new Date,"yyyy-MM-dd"))}},eU=e=>{ec(e),em(!1===e.is_locked),ei(!0)},ez=async()=>{if(eo&&C)try{let e=ed?"lock_time_entry":"unlock_time_entry",{data:t,error:s}=await W.rpc(e,{entry_id:eo.id,user_email:C.username});if(s)throw s;Z(E.map(e=>e.id===eo.id?{...e,is_locked:ed,unlocked_by:ed?null:C.username,unlocked_at:ed?null:new Date().toISOString()}:e)),ei(!1),ec(null)}catch(e){alert("Error: "+e.message)}},eR=(0,r.useMemo)(()=>Array.from(new Set(E.map(e=>e.employee_name))).sort(),[E]),eq=()=>{let e=eP;return"all"!==ep&&(e=e.filter(e=>e.approval_status===ep)),e},eP=(0,r.useMemo)(()=>[...E].sort((e,t)=>{let s=0;switch(es){case"datetime":let a=e.txn_date.localeCompare(t.txn_date);0!==a?s=a:e.start_time&&t.start_time&&(s=e.start_time.localeCompare(t.start_time));break;case"employee":s=e.employee_name.localeCompare(t.employee_name);break;case"costcode":s=(e.cost_code||"").localeCompare(t.cost_code||"")}return"asc"===er?s:-s}),[E,es,er]),eW=(0,r.useMemo)(()=>{let e=new Map;return eP.forEach(t=>{let s=t.qb_customer_id;e.has(s)||e.set(s,[]),e.get(s).push(t)}),e},[eP]),eX=e=>(e.reduce((e,t)=>e+60*t.hours+t.minutes,0)/60).toFixed(1),eQ=e=>{let[t,s,a]=e.split("-").map(Number);return new Date(t,s-1,a)},eL=e=>{if(e.start_time&&e.end_time){var t,s;let a=new Date((null===(t=e.start_time)||void 0===t?void 0:t.includes("T"))?e.start_time:"2000-01-01T".concat(e.start_time)),r=new Date((null===(s=e.end_time)||void 0===s?void 0:s.includes("T"))?e.end_time:"2000-01-01T".concat(e.end_time)),l=(0,v.WU)(a,"h:mm a"),n=(0,v.WU)(r,"h:mm a");return"".concat(l," - ").concat(n)}return"Lump sum entry"},eY=(e,t)=>"".concat(e,".").concat(t.toString().padStart(2,"0")," hrs");return(0,r.useEffect)(()=>{eI()},[]),(0,r.useEffect)(()=>{eD()},[Y,V,K,ee]),(0,a.jsxs)(D.Z,{children:[(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(f.default,{href:"/",className:"text-gray-600 hover:text-gray-900",children:(0,a.jsx)(l.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Time Entries - Weekly Reports"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Production QuickBooks Data"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right hidden md:block",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==C?void 0:C.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null==C?void 0:C.username})]}),(0,a.jsxs)("button",{onClick:eF,disabled:B,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4 ".concat(B?"animate-spin":"")}),B?"Syncing...":"Sync from QB"]}),(0,a.jsx)("button",{onClick:()=>{t.logoutPopup()},className:"px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Sign Out",children:(0,a.jsx)(i.Z,{className:"w-5 h-5"})})]})]})})}),(0,a.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[["this_week","last_week","this_month","last_month"].map(e=>(0,a.jsx)("button",{onClick:()=>eB(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(Q===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},e)),(0,a.jsx)("button",{onClick:()=>eB("all_time"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("all_time"===Q?"bg-green-600 text-white":"bg-green-100 text-green-700 hover:bg-green-200"),children:"\uD83D\uDCCA Show All Data"})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"From"}),(0,a.jsx)("input",{type:"date",value:Y,onChange:e=>{G(e.target.value),L("custom")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"To"}),(0,a.jsx)("input",{type:"date",value:V,onChange:e=>{H(e.target.value),L("custom")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer"}),(0,a.jsxs)("select",{value:K,onChange:e=>$(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Customers"}),M.map(e=>(0,a.jsx)("option",{value:e.qb_customer_id,children:e.display_name},e.qb_customer_id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee"}),(0,a.jsxs)("select",{value:ee,onChange:e=>et(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Employees"}),eR.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approval Status"}),(0,a.jsxs)("select",{value:ep,onChange:e=>eh(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Status"}),(0,a.jsx)("option",{value:"pending",children:"⏳ Pending"}),(0,a.jsx)("option",{value:"approved",children:"✅ Approved"}),(0,a.jsx)("option",{value:"sent",children:"\uD83D\uDCE7 Sent"}),(0,a.jsx)("option",{value:"delivered",children:"\uD83D\uDCEC Delivered"}),(0,a.jsx)("option",{value:"read",children:"\uD83D\uDCD6 Read"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[[{value:"datetime",label:"Date/Time"},{value:"employee",label:"Employee"},{value:"costcode",label:"Cost Code"}].map(e=>(0,a.jsx)("button",{onClick:()=>ea(e.value),className:"flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(es===e.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value)),(0,a.jsx)("button",{onClick:()=>el("asc"===er?"desc":"asc"),className:"px-3 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors flex items-center gap-1",title:"asc"===er?"Oldest to Newest":"Newest to Oldest",children:"asc"===er?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Old→New"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"New→Old"})]})})]})]})]})]})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[R&&(0,a.jsx)("div",{className:"mb-6 border-2 rounded-lg p-6 shadow-lg ".concat(R.startsWith("✅")?"bg-green-50 border-green-300":"bg-red-50 border-red-300"),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"mt-1 ".concat(R.startsWith("✅")?"text-green-600":"text-red-600"),children:R.startsWith("✅")?"✅":"⚠️"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2 ".concat(R.startsWith("✅")?"text-green-900":"text-red-900"),children:R.startsWith("✅")?"Success":"Sync Error"}),(0,a.jsx)("p",{className:"whitespace-pre-wrap font-mono text-sm ".concat(R.startsWith("✅")?"text-green-800":"text-red-800"),children:R}),!R.startsWith("✅")&&(0,a.jsx)("p",{className:"text-red-600 text-xs mt-3",children:"Check browser console (F12) for detailed debug logs."})]})]})}),A?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(n.Z,{className:"w-8 h-8 text-blue-600 animate-spin"})}):0===E.length?(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[(0,a.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Time Entries Found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"No time entries found for the selected date range and filters."}),(0,a.jsxs)("button",{onClick:eF,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"Sync from QuickBooks"]})]}):(0,a.jsxs)(a.Fragment,{children:[E.some(e=>!e.is_locked)&&(0,a.jsx)("div",{className:"mb-4 bg-orange-50 border-l-4 border-orange-500 p-3 rounded-r-md",children:(0,a.jsxs)("p",{className:"text-sm text-orange-800",children:[(0,a.jsxs)("strong",{children:[E.filter(e=>!e.is_locked).length," entries"]})," are unlocked and editable. Changes will not sync to QuickBooks."]})}),(0,a.jsx)("div",{className:"mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Total Entries: ",(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:E.length})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Total Hours: ",(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:[eX(E)," hrs"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:eM,disabled:0===ex.size||eg,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:0===ex.size?"Select entries to approve":"Approve ".concat(ex.size," selected entries"),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"Approve Selected (",ex.size,")"]}),(0,a.jsxs)("button",{onClick:eT,disabled:eg||0===E.filter(e=>"pending"===e.approval_status).length,className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve all pending entries for current filter",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"Approve All Pending"]}),ex.size>0&&(0,a.jsxs)("button",{onClick:()=>{eu(new Set)},className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",title:"Clear selection",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),"Clear"]})]}),(0,a.jsxs)("button",{onClick:()=>{try{let e=eP.map(e=>{let t=(0,v.WU)(eQ(e.txn_date),"MM/dd/yyyy"),s=e.start_time?(0,v.WU)(new Date(e.start_time),"h:mm a"):"N/A",a=e.end_time?(0,v.WU)(new Date(e.end_time),"h:mm a"):"N/A",r="".concat(e.hours,".").concat(e.minutes.toString().padStart(2,"0"));return[t,e.employee_name,e.qb_customer_id,e.cost_code,s,a,r,e.billable_status,e.approval_status,(e.notes||"").replace(/"/g,'""')]}),t=["Date,Employee,Customer,Cost Code,Start Time,End Time,Hours,Billable,Status,Notes",...e.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),r=URL.createObjectURL(s);a.setAttribute("href",r),a.setAttribute("download","time_entries_".concat(Y,"_to_").concat(V,".csv")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),console.log("✅ Report generated successfully")}catch(e){console.error("❌ Report generation failed:",e),X("Failed to generate report: "+(e instanceof Error?e.message:"Unknown error"))}},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:0===E.length,title:0===E.length?"No entries to report":"Download CSV report",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"Generate Report"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("button",{onClick:()=>eE("david@mitigationconsulting.com","David"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-t-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:0===E.length,title:"Email report to David for testing",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),"Email to Me"]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-xs text-blue-700 border border-blue-200 rounded-b-lg text-center",children:"david@mitigationconsulting.com"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("button",{onClick:()=>eE("sharon@mitigationconsulting.com","Bookkeeper"),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-t-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:0===E.length,title:"Email report to Sharon Kisner (Bookkeeper)",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),"Email to Bookkeeper"]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-50 text-xs text-purple-700 border border-purple-200 rounded-b-lg text-center",children:"sharon@mitigationconsulting.com"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("button",{onClick:eZ,disabled:0===E.length||"all"===K,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-t-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400",title:0===E.length?"No entries to email":"all"===K?"Select a specific customer first":"Email report to customer",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),"Email to Insured"]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-orange-50 text-xs text-orange-700 border border-orange-200 rounded-b-lg text-center",children:"all"===K?"Select customer first":(null===(e=M.find(e=>e.qb_customer_id===K))||void 0===e?void 0:e.email)||"No email set"})]})]})]})]})}),"all"===K?Array.from(eW.entries()).map(e=>{var t;let[s,r]=e,l=(null===(t=M.find(e=>e.qb_customer_id===s))||void 0===t?void 0:t.display_name)||s;return(0,a.jsxs)("div",{className:"mb-6 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(h.Z,{className:"w-6 h-6 text-white"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:l}),(0,a.jsxs)("p",{className:"text-blue-100 text-sm",children:[r.length," entries • ",eX(r)," hours"]})]})]})})}),(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:r.map((e,t)=>(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,a.jsx)("input",{type:"checkbox",checked:ex.has(e.id),onChange:()=>eO(e.id),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500",title:"Select for approval"})}),(0,a.jsxs)("div",{className:"flex-shrink-0 w-48",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-900 font-medium",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 text-gray-400"}),(0,v.WU)(eQ(e.txn_date),"EEE MMM dd, yyyy")]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 text-gray-400"}),eL(e)]}),(0,a.jsx)("div",{className:"text-sm font-semibold text-blue-600 mt-1",children:eY(e.hours,e.minutes)})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.employee_name})]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:e.service_item_name||e.cost_code}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded ".concat("Billable"===e.billable_status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:e.billable_status}),(0,a.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded ".concat("pending"===e.approval_status?"bg-yellow-100 text-yellow-700":"approved"===e.approval_status?"bg-emerald-100 text-emerald-700":"sent"===e.approval_status?"bg-blue-100 text-blue-700":"delivered"===e.approval_status?"bg-indigo-100 text-indigo-700":"read"===e.approval_status?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"),children:["pending"===e.approval_status&&"⏳ Pending","approved"===e.approval_status&&"✅ Approved","sent"===e.approval_status&&"\uD83D\uDCE7 Sent","delivered"===e.approval_status&&"\uD83D\uDCEC Delivered","read"===e.approval_status&&"\uD83D\uDCD6 Read",!e.approval_status&&"No Status"]}),(0,a.jsx)(O,{isLocked:e.is_locked,unlockedBy:e.unlocked_by,unlockedAt:e.unlocked_at,onToggle:()=>eU(e)}),e.manually_edited&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-amber-100 text-amber-700",children:"Edited"}),(0,a.jsxs)("button",{onClick:()=>{ev(e),ej(!0)},className:"flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",title:"View tracking history",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3"}),"History"]}),!e.is_locked&&(0,a.jsxs)("button",{onClick:()=>{eC(e),ek(!0)},className:"flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors",title:"Enhance notes with AI",children:[(0,a.jsx)(j.Z,{className:"w-3 h-3"}),"Enhance"]})]}),e.description&&(0,a.jsxs)("div",{className:"text-sm text-gray-700 mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Description:"})," ",e.description]}),(0,a.jsx)(q,{entryId:e.id,currentNotes:e.notes,isLocked:e.is_locked,isSaving:eN,onSave:eA})]})]})},e.id))}),(0,a.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Total for ",l]}),(0,a.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[eX(r)," hours"]})]})})]},s)}):(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:eP.map(e=>(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,a.jsx)("input",{type:"checkbox",checked:ex.has(e.id),onChange:()=>eO(e.id),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500",title:"Select for approval"})}),(0,a.jsxs)("div",{className:"flex-shrink-0 w-48",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-900 font-medium",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 text-gray-400"}),(0,v.WU)(eQ(e.txn_date),"EEE MMM dd, yyyy")]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 text-gray-400"}),eL(e)]}),(0,a.jsx)("div",{className:"text-sm font-semibold text-blue-600 mt-1",children:eY(e.hours,e.minutes)})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.employee_name})]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:e.service_item_name||e.cost_code}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded ".concat("Billable"===e.billable_status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:e.billable_status}),(0,a.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold rounded ".concat("pending"===e.approval_status?"bg-yellow-100 text-yellow-700":"approved"===e.approval_status?"bg-emerald-100 text-emerald-700":"sent"===e.approval_status?"bg-blue-100 text-blue-700":"delivered"===e.approval_status?"bg-indigo-100 text-indigo-700":"read"===e.approval_status?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"),children:["pending"===e.approval_status&&"⏳ Pending","approved"===e.approval_status&&"✅ Approved","sent"===e.approval_status&&"\uD83D\uDCE7 Sent","delivered"===e.approval_status&&"\uD83D\uDCEC Delivered","read"===e.approval_status&&"\uD83D\uDCD6 Read",!e.approval_status&&"No Status"]}),(0,a.jsx)(O,{isLocked:e.is_locked,unlockedBy:e.unlocked_by,unlockedAt:e.unlocked_at,onToggle:()=>eU(e)}),e.manually_edited&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-amber-100 text-amber-700",children:"Edited"}),(0,a.jsxs)("button",{onClick:()=>{ev(e),ej(!0)},className:"flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",title:"View tracking history",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3"}),"History"]}),!e.is_locked&&(0,a.jsxs)("button",{onClick:()=>{eC(e),ek(!0)},className:"flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors",title:"Enhance notes with AI",children:[(0,a.jsx)(j.Z,{className:"w-3 h-3"}),"Enhance"]})]}),e.description&&(0,a.jsxs)("div",{className:"text-sm text-gray-700 mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Description:"})," ",e.description]}),(0,a.jsx)(q,{entryId:e.id,currentNotes:e.notes,isLocked:e.is_locked,isSaving:eN,onSave:eA})]})]})},e.id))})})]})]})]}),(0,a.jsx)(T,{isOpen:en,isLocking:ed,entryDetails:eo||void 0,onConfirm:ez,onCancel:()=>{ei(!1),ec(null)}}),(0,a.jsx)(U,{isOpen:ey,entryId:(null==ef?void 0:ef.id)||null,entryDetails:ef?{employee_name:ef.employee_name,txn_date:ef.txn_date,hours:ef.hours,minutes:ef.minutes}:void 0,onClose:()=>{ej(!1),ev(null)}}),(0,a.jsx)(P,{isOpen:e_,entry:eS,onAccept:eA,onClose:()=>{ek(!1),eC(null)}})]})}},64872:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(57437),r=s(18112),l=s(34847),n=s(91723),i=s(29090);function o(e){let{children:t}=e,{instance:s,accounts:o}=(0,r.Fp)(),c=o.length>0,d=async()=>{try{await s.loginPopup(l.Qb)}catch(e){console.error("Login failed:",e)}};return c?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"w-10 h-10 text-white"})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"MIT Consulting"}),(0,a.jsx)("p",{className:"text-gray-600",children:"QuickBooks Timesheet System"})]}),(0,a.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Authentication Required:"})," Please sign in with your Microsoft account to access this page."]})}),(0,a.jsxs)("button",{onClick:d,className:"w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5"}),"Sign in with Microsoft"]})]})})}},34847:function(e,t,s){"use strict";s.d(t,{Qb:function(){return r},XM:function(){return a}});let a={auth:{clientId:"973b689d-d96c-4445-883b-739fff12330b",authority:"https://login.microsoftonline.com/".concat("aee0257d-3be3-45ae-806b-65c972c98dfb"),redirectUri:"http://localhost:3000"},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}},r={scopes:["User.Read","email","profile","openid","Mail.Send","Mail.ReadWrite"]}},93303:function(e,t,s){"use strict";s.d(t,{O:function(){return n},i:function(){return i}});var a=s(13053);let r="https://migcpasmtbdojqphqyzc.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ2NwYXNtdGJkb2pxcGhxeXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTk3MjYsImV4cCI6MjA4NTI3NTcyNn0.90w8O2oX76uPTuFp092jTCZoL95lJ7YnaOPMGcRP2fQ",n=(0,a.eI)(r,l);async function i(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",a="".concat(r,"/functions/v1/").concat(e),n=await fetch(a,{method:s,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:t?JSON.stringify(t):void 0});if(!n.ok){let e=await n.text();throw Error("Edge Function error: ".concat(e))}return n.json()}}},function(e){e.O(0,[641,85,112,873,971,117,744],function(){return e(e.s=28840)}),_N_E=e.O()}]);